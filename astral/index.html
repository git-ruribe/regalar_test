<!DOCTYPE HTML>
<!--
	Astral by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>3D Fine Art - Augmented Reality Virtual Gifts</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>

		<!-- https://developers.google.com/ar/develop/webxr/model-viewer -->
		<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

	</head>

	<style>
        model-viewer {
          width: 90%;
          height: 50vh;
        }
    </style>

	<body class="is-preload">

		<!-- Wrapper-->
			<div id="wrapper" style="min-height: 0px;">

				<!-- Nav -->
					<nav id="nav">
						<a href="#home" class="icon solid fa-home"><span>Home</span></a>
						<a href="#work" class="icon solid fa-hand-pointer"><span>Select</span></a>
						<a href="#card" class="icon solid fa-edit"><span>Customize</span></a>
						<a href="#getAR" class="icon solid fa-file-export"><span>Get</span></a>
					</nav>

				<!-- Main -->
					<div id="main">

						<!-- Me -->
							<article id="home" class="panel intro">
								
								<header>
									<h1>3D Fine Art</h1>
									<p>Give AR Experiences, Not Things</p>
								</header>
								<a href="#work" class="jumplink pic">
									<span class="arrow icon solid fa-chevron-right"><span>Select an experience</span></span>
									<img src="images/girl.jpg" alt="" />
								</a>
							
							</article>

						<!-- Work -->
							<article id="work" class="panel">
								<header>
									<h2>Select an AR Experience</h2>
								</header>
								<p>
									Choose one of our Interactive Multimedia Augmented Reality Experiences.
								</p>
								<section>
									<div class="row">
										<div class="col-4 col-6-medium col-12-small">
											<a id="t0001" href="#card" class="image fit" onclick="seleccion('0001')">
												<picture>
													<source type="image/webp" srcset="/thumbnails/0001.webp">
													<source type="image/png" srcset="/thumbnails/0001.jpg">
													<img alt="A thumnail of an Augmented Reality Experience showing a Butterfly escapig from a Music Box." src="/thumbnails/0001.jpg" width="100%" height=auto>
												  </picture>                 
											</a>
											<strong>Fly Free</strong> <small>by RU72</small>
										</div>
										<!--
										<div class="col-4 col-6-medium col-12-small">
											<a id="t0002" href="#card" class="image fit" onclick="seleccion('0002')">
												<picture>
													<source type="image/webp" srcset="/thumbnails/0002.webp">
													<source type="image/png" srcset="/thumbnails/0002.png">
													<img alt="A thumnail of an Augmented Reality Experience showing a red heart floating inside a steampunk gyroscope." src="/thumbnails/0002.png" width="100%" height=auto>
												  </picture>  
											</a>
											<strong>Take Care</strong> <small>by RU72</small>
										</div>   
										<div class="col-4 col-6-medium col-12-small">
											<a id="t0003" href="#card" class="image fit" onclick="seleccion('0003')">
												<picture>
													<source type="image/webp" srcset="/thumbnails/0003.webp">
													<source type="image/png" srcset="/thumbnails/0003.png">
													<img alt="A thumnail of an Augmented Reality Experience showing a large safebox door in an abandoned warehouse." src="/thumbnails/0003.png" width="100%" height=auto>
												  </picture>  
											</a>
											<strong>Call Me</strong> <small>by RU72</small>
										</div>
										<div class="col-4 col-6-medium col-12-small" onclick="seleccion('0004')">
											<a id="t0004" href="#card" class="image fit">
												<picture>
													<source type="image/webp" srcset="/thumbnails/0004.webp">
													<source type="image/png" srcset="/thumbnails/0004.png">
													<img alt="A thumnail of an Augmented Reality Experience showing a hummingbird visiting a cactus flower in a terracota pot." src="/thumbnails/0004.png" width="100%" height=auto>
												  </picture>  
											</a>
											<strong>The Visitant</strong> <small>by RU72</small>
										</div>
										-->
										<div class="col-4 col-6-medium col-12-small">
											<a href="#work" class="image fit"><img src="images/pic02.jpg" alt=""></a>
											<strong>Coming Soon</strong> <small></small>
										</div>
										<div class="col-4 col-6-medium col-12-small">
											<a href="#work" class="image fit"><img src="images/pic03.jpg" alt=""></a>
											<strong>Coming Soon</strong> <small></small>
										</div>
										<div class="col-4 col-6-medium col-12-small">
											<a href="#work" class="image fit"><img src="images/pic04.jpg" alt=""></a>
											<strong>Coming Soon</strong> <small></small>
										</div>
										<div class="col-4 col-6-medium col-12-small">
											<a href="#work" class="image fit"><img src="images/pic05.jpg" alt=""></a>
											<strong>Coming Soon</strong> <small></small>
										</div>
										<div class="col-4 col-6-medium col-12-small">
											<a href="" class="image fit"><img src="images/pic06.jpg" alt=""></a>
											<strong>Coming Soon</strong> <small></small>
										</div>
										<div class="col-4 col-6-medium col-12-small">
											<a href="#work" class="image fit"><img src="images/pic07.jpg" alt=""></a>
											<strong>Coming Soon</strong> <small></small>
										</div>
										<div class="col-4 col-6-medium col-12-small">
											<a href="#work" class="image fit"><img src="images/pic08.jpg" alt=""></a>
											<strong>Coming Soon</strong> <small></small>
										</div>
										<div class="col-4 col-6-medium col-12-small">
											<a href="#work" class="image fit"><img src="images/pic09.jpg" alt=""></a>
											<strong>Coming Soon</strong> <small></small>
										</div>
										<div class="col-4 col-6-medium col-12-small">
											<a href="#work" class="image fit"><img src="images/pic10.jpg" alt=""></a>
											<strong>Coming Soon</strong> <small></small>
										</div>
										<div class="col-4 col-6-medium col-12-small">
											<a href="#work" class="image fit"><img src="images/pic11.jpg" alt=""></a>
											<strong>Coming Soon</strong> <small></small>
										</div>
										<div class="col-4 col-6-medium col-12-small">
											<a href="#work" class="image fit"><img src="images/pic12.jpg" alt=""></a>
											<strong>Coming Soon</strong> <small></small>
										</div>
									</div>
								</section>
							</article>

						<!-- Contact -->
							<article id="card" class="panel">
								<header>
									<h2>Write a Gift Card Message</h2>
								</header>
								<p>
									The card will be included in your customized Augmented Reality Experience.
								</p>
								<form action="#getAR">
									<div>
										<div class="row">
											<div class="col-12">
												<input type="text" id="title" name="title" placeholder="Title (15 chars)" maxlength="15" onchange="cardchange()"/>
											</div>

											<div class="col-12" >
												<input type="text" id="line1" name="line1" placeholder="Card Row 1 (23 chars)" maxlength="23" onchange="cardchange()"/>
											</div>
											<div class="col-12" style="padding-top: 3px;">
												<input type="text" id="line2" name="line2" placeholder="Card Row 2 (23 chars)" maxlength="23" onchange="cardchange()"/>
											</div>
											<div class="col-12" style="padding-top: 3px;">
												<input type="text" id="line3" name="line3" placeholder="Card Row 3 (23 chars)" maxlength="23" onchange="cardchange()"/>
											</div>
											<div class="col-12" style="padding-top: 3px;">
												<input type="text" id="line4" name="line4" placeholder="Card Row 4 (23 chars)" maxlength="23" onchange="cardchange()"/>
											</div>
											<div class="col-12">
												<input type="text" id="bottom" name="bottom" placeholder="Footer (17 chars)" maxlength="15" onchange="cardchange()"/>
											</div>
											<div class="col-12">
												<input type="button" value="Attach the Card to AR Experience " onclick="messageWriten()"/>
											</div>
											
									</div>
								</form>

								<div class="row" style="padding-top: 40px;">
									<img id="imagen" class="col-6 col-12-medium col-12-small" src="/experiences/Material_baseColor.png" height="auto" style="-webkit-transform: scaleY(-1);
									transform: scaleY(-1);">
							
									<canvas hidden id="canvas" width="512" height="512"></canvas>
								</div>

							</article>
						
						
						<!-- Contact -->
						<article id="getAR" class="panel">
							<header>
								<h2>Test and Send</h2>
							</header>

							<div id="step1" class="icon fa-square"><span>&ensp; Select an AR Experience</span></div>
							<div id="step2" class="icon fa-square"><span>&ensp; Write Card Message</span></div>
							<div id="step3" class="icon fa-square"><span>&ensp; Custom AR Experience Ready</span></div>


							<model-viewer id="modelviewer" autoplay src="/exps/0001/gltf/exp0001.gltf"
								ios-src="/exps/0001/usdz/exp0001_m.usdz"
								alt="Augmented Reality Experience - Butterfly in a Music Box"
								ar
								autoplay
								ar-modes="webxr scene-viewer quick-look" 
								camera-controls
								poster="/thumbnails/0001.jpg">
							</model-viewer>

							<div class="col-12">
								<input type="button" value="Remake AR Experience " onclick="generaUSDZ_C()"/>
							</div>

							<br>

							<button id="descargaUSDZ" disabled>Descarga USDZ</button>
							<!-- 
							<section>
								<div class="row" style="padding-top: 20px;">
									<div class="col-12 col-12-medium col-12-small">
										<a hidden id="usdz" rel="ar" href="/experiences/0001/exp0001_m.usdz">
											<picture>
												<source id="usdzWEBP" type="image/webp" srcset="/thumbnails/0001.webp">
												<source  id="usdzPNG"type="image/png" srcset="/thumbnails/0001.png">
												<img id="usdzIMG" src="/thumbnails/0001.png" width="100%" height=auto>
											  </picture> 
										</a>
									</div>
								</div>
							</section>	
							-->

						</article>

					</div>
					

				<!-- Footer -->
					<div id="footer">
						<ul class="copyright">
							<li>&copy; 3Dfine.art.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
						</ul>
					</div>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

			<script type="module">

				import '/jszip/jszip.js';
	
			</script>

			<script>

				var selected = '0000'
				var title = ''
				var row1 = ''
				var row2 = ''
				var row3 = ''
				var row4 = ''
				var footer = ''

				function seleccion(item) {
					console.log(item);
					selected = item;
					if (selected!='0000') {
						document.getElementById('step1').className = "icon solid fa-check-square"
					}

					/*
					document.getElementById('usdz').href = "/experiences/"+selected+"/exp" + selected +"_m.usdz"
					document.getElementById('usdzWEBP').srcset = "/thumbnails/" + selected +".webp"
					document.getElementById('usdzPNG').srcset = "/thumbnails/" + selected +".png"
					document.getElementById('usdzIMG').src = "/thumbnails/" + selected +".png"
					document.getElementById('usdz').hidden = false
					*/
					
				}

				function messageWriten() {
					document.getElementById('step2').className = "icon solid fa-check-square";
					window.location.hash = '#getAR';
				}

				async function cardchange() {

					var text0 = document.getElementById("title").value;
					var text1 = document.getElementById("line1").value;
					var text2 = document.getElementById("line2").value;
					var text3 = document.getElementById("line3").value;
					var text4 = document.getElementById("line4").value;
					var text5 = document.getElementById("bottom").value;

					imagePath = "/experiences/Material_baseColor.png"

					async function addTextToImage(imagePath, text0, text1="", text2="", text3="", text4="", text5="", x=257, y=367, weight="600", fontsize0="48", fontsize1="30", fontsize2="40", fontfamily="ocr-a-std", align="center") {
						return new Promise(resolve =>{
						var circle_canvas = document.getElementById("canvas");
						//var circle_canvas = newCanvas
						var context = circle_canvas.getContext("2d");


						circle_canvas.style.width = "512px"
						circle_canvas.style.height = "512px"

						circle_canvas.width = 1024
						circle_canvas.height = 1024

						// Draw Image function
						var img = new Image();
						img.src = imagePath;
						img.onload = function () {
							context.scale(2,2)
							context.drawImage(img, 0, 0);
							context.lineWidth = 1;
							context.fillStyle = "#000000";
							context.lineStyle = "#000000";
							context.textAlign = align
							context.scale(1,-1)
							context.font = weight + " normal "+ fontsize0 +"px "+ fontfamily +",sans-serif";
							context.fillText(text0, x, -y);
							context.font = weight + " normal "+ fontsize1 +"px "+ fontfamily +",sans-serif";
							context.fillText(text1, x, -y+64);
							context.font = weight + " normal "+ fontsize1 +"px "+ fontfamily +",sans-serif";
							context.fillText(text2, x, -y+100);
							context.font = weight + " normal "+ fontsize1 +"px "+ fontfamily +",sans-serif";
							context.fillText(text3, x, -y+136);
							context.font = weight + " normal "+ fontsize1 +"px "+ fontfamily +",sans-serif";
							context.fillText(text4, x, -y+172);
							context.font = weight + " normal "+ fontsize2 +"px "+ fontfamily +",sans-serif";
							context.fillText(text5, x, -y+230);
							context.restore();
							
							//console.log(context.font);
							resolve()
						};
					})}

					//console.log(text0);
					await addTextToImage(imagePath, text0, text1=text1, text2=text2, text3=text3, text4=text4, text5=text5)

					var canvas = document.getElementById("canvas");
					var image = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");  // here is the most important part because if you dont replace you will get a DOM 18 exception.

					//console.log(image);

					var element = document.getElementById("imagen");
					element.src = image


				}

			</script>

			<script>

				function downloadUSDZ(data, filename, type) {
					var file = new Blob([data], {type: type});
					if (window.navigator.msSaveOrOpenBlob) // IE10+
						window.navigator.msSaveOrOpenBlob(file, filename);
					else { // Others
						const a = document.createElement("a");
								if (a.relList.supports("ar")) { // esto debe ir directamente al generar el modelo para el caso de dispositivos con AR ... revisar caso si quiere enviar a otro dispositivo.
									url = URL.createObjectURL(file);
									document.getElementById("modelviewer").setAttribute("ios-src")=url;
								} else {
									url = URL.createObjectURL(file);
									a.href = url;
									a.download = filename;
									document.body.appendChild(a);
									a.click();
									setTimeout(function() {
										document.body.removeChild(a);
										window.URL.revokeObjectURL(url);  
									}, 0); 
								}
					}
				}

				function loadBlob(filePath) {
					return new Promise(resolve =>{
						var result = null;
						var xmlhttp = new XMLHttpRequest();
						xmlhttp.open("GET", filePath, true);
						xmlhttp.responseType = "arraybuffer";

						xmlhttp.onload = function (oEvent) {
							var arrayBuffer = xmlhttp.response;

							resolve(arrayBuffer)
						}
						
						xmlhttp.send(null);
					}
					)
				}

				async function generaUSDZ_C() {

					var canvas = document.getElementById("canvas");

					var tempCanvas = document.createElement("canvas"),
					tempCtx = tempCanvas.getContext("2d");

					tempCanvas.width = canvas.width;
					tempCanvas.height = canvas.height;
					tempCtx.translate(canvas.width/2,canvas.height/2+30);
					tempCtx.rotate(180 * Math.PI / 180);
					tempCtx.drawImage(canvas,-canvas.width/2,-canvas.height/2);
					// put our data onto the temp canvas
					//tempCtx.drawImage(canvas,0,0,canvas.width,canvas.height);
					tempCtx.restore();
					
					var image = tempCanvas.toDataURL("image/png").replace("image/png", "image/octet-stream");  // here is the most important part because if you dont replace you will get a DOM 18 exception.

					var zip2 = new JSZip();
					zip2.file("3DfineArtFlyFree.usdc",await loadBlob("/exps/0001/usdc/exp0001_m.usdc"))

					zip2.file("0/music.mp3", await loadBlob("/exps/0001/usdc/0/music.mp3"))

					zip2.file("1/texgen_10.png", await loadBlob(image))
					zip2.file("1/texgen_11.png", await loadBlob("/exps/0001/usdc/1/texgen_11.png"))

					/*
					zip2.file("1/mat1_baseColor.jpg", await loadBlob("./experiences/0001/1/mat1_baseColor.jpg"))
					zip2.file("1/phong1_baseColor.jpg", await loadBlob("./experiences/0001/1/phong1_baseColor.jpg"))
					zip2.file("1/phong1_metallicRoughness_metal.jpg", await loadBlob("./experiences/0001/1/phong1_metallicRoughness_metal.jpg"))
					zip2.file("1/phong1_metallicRoughness_rough_scale0.jpg", await loadBlob("./experiences/0001/1/phong1_metallicRoughness_rough_scale0.jpg"))
					zip2.file("1/phong1_metallicRoughness_rough_scale1.jpg", await loadBlob("./experiences/0001/1/phong1_metallicRoughness_rough_scale1.jpg"))
					zip2.file("1/phong1_metallicRoughness_rough_scale2.jpg", await loadBlob("./experiences/0001/1/phong1_metallicRoughness_rough_scale2.jpg"))
					zip2.file("1/phong1_metallicRoughness_rough.jpg", await loadBlob("./experiences/0001/1/phong1_metallicRoughness_rough.jpg"))
					*/

					zip2.generateAsync({type:"blob"})
						.then(function (blob) {

							// Reportar Conversión
							//gtag_report_conversion()

							const a = document.createElement("a");
								if (a.relList.supports("ar")) {
								// AR is available.

								/*
									console.log("AR disponible");

									var file = new Blob([blob], {type:"model/vnd.usdz+zip"});
									var url = URL.createObjectURL(file);

									var elementAR = document.getElementById("usdzPlacer");
									elementAR.rel = "ar"
									elementAR.href = url

									document.getElementById("blob").innerHTML = "Remake 3D Model";
									document.getElementById("blob").style.color = "black";
									document.getElementById("blob").disabled = false;
									document.getElementById("tarjeta").disabled = false;

									document.getElementById("descarga").onclick = function(event) {
										downloadX(blob, "regalAR.usdz", "model/vnd.usdz+zip");
									}
									*/
									document.getElementById("descarga").disabled = false;
									document.getElementById("descarga").innerHTML = "Listo";

								} else {
									console.log("AR NO disponible");

									document.getElementById("descargaUSDZ").onclick = function(event) {
										downloadUSDZ(blob, "3DfineArtFlyFree.usdz", "model/vnd.usdz+zip");
									}

									document.getElementById("descargaUSDZ").disabled = false;
									
								}
							console.log("OK");
						});
				}

			</script>

	</body>
</html>