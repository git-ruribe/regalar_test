<!DOCTYPE html>
<html lang="en">
    <head>
		<title>Call Me</title>
        
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <meta name="description" content="A masive safe with a red emergency phone inside multimedia Augmented Reality Experience, customize as a virtual gift.">


        <!-- https://favicon.io/favicon-generator/ -->
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/site.webmanifest">

        <!-- <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"> solo para imagen responsiva -->

        <!--<link rel="stylesheet" href="https://use.typekit.net/oep8ygu.css"> -->

        <link rel="stylesheet" href="/w3.css"> 
        <link rel="stylesheet" href="/oep8ygu.css"> 

        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-5MRSZFMLLX"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-5MRSZFMLLX');
        gtag('config', 'UA-176287415-1');
        </script>

    </head>

    <body style="
        display: block;
        margin-top: 0px;
        margin-right: 0px;
        margin-bottom: 0px;
        margin-left: 0px;
        overflow-wrap: break-word;">

        <!-- Navbar (sit on top) -->
        <div style="
            padding: 6vw;
            font-size: calc((1.2 - 1) * 1.2vh + 1rem);
            font-family: orpheuspro,serif;
            font-weight: 400;
            font-style: normal;
            letter-spacing: 0em;
            text-transform: none;
            line-height: 1.4em;
            ">
            <div>
            <a href="./"  style="
            text-decoration: none;
            font-size: calc((2 - 1) * 1.2vh + 1rem);"><strong>3D fine art</strong></a>
            <!-- Float links to the right. Hide them on small screens -->
            <div style="font-size: calc((1.2 - 1) * 1.2vw + 1rem);">   
            </div>
            </div>
        </div>

        <!-- Header 
        <header class="w3-display-container w3-content w3-wide" style="max-width:1500px;" id="home">
            <img class="w3-image" src="/w3images/architect.jpg" alt="Architecture" width="1500" height="800">
            <div class="w3-display-middle w3-margin-top w3-center">
            <h1 class="w3-xxlarge w3-text-white"><span class="w3-padding w3-black w3-opacity-min"><b>BR</b></span> <span class="w3-hide-small w3-text-light-grey">Architects</span></h1>
            </div>
        </header>
        -->

		<div id="info" style="
        padding-top: 3.3vw;
        padding-bottom: 3.3vw;
        padding-left: 6vw;
        padding-right: 6vw;
        font-family: orpheuspro,serif;
        line-height: 1.2992;
        font-weight: 400;
        font-style: normal;
        letter-spacing: 0em;
        text-transform: none;
        -webkit-font-smoothing: antialiased;
        -webkit-text-size-adjust: 100%;
        ">
            <div style="
            font-size: calc((2.8 - 1) * 1.2vh + 1rem);">
            Call Me
            </div>

            <div style="
                display: flex;
                flex-wrap: nowrap;
                flex-shrink: 1;
                flex-grow: 0;
                flex-direction:row;">
                <div style="
                    font-size: calc((1.2 - 1) * 1.2vh + 1rem);
                    margin-top: 2rem;
                    margin-right: 0px;
                    margin-bottom: 0rem;
                    margin-left: 0px;
                    max-width: 500px;
                    height: auto;">
                    A masive augmented reality experience. You have to go inside the vault to read the gift card. Inside is almost empty, just a red telephone and a card. Is this a telephone cabinet? Why a vault? Does the red telephone symbolizes the heart? Someone is letting you in? You decide the meaning on this abstrtact experience.
                </div>
                
            </div>

            <div style="
                display: flex;
                flex-wrap: nowrap;
                flex-shrink: 1;
                flex-grow: 0;
                flex-direction:row;">
            <div style="
            margin-top: 2rem;
            margin-right: 0px;
            margin-bottom: 0rem;
            margin-left: 0px;
            max-width: 500px;
            height: auto;">
            <p style="font-size: small;">
                * AR viewing requires a device running iPadOS or iOS 12 or later.
                </p>
            “This work of art includes  
                <a href="https://sketchfab.com/3d-models/massive-door-with-animation-f5cad02b491748e68db5e5c64824751a">Massive Door with Animation</a> 
                 by <a href="https://sketchfab.com/dennish2010">3DHaupt</a> and  
                 <a href="https://sketchfab.com/3d-models/red-telephone-emergency-phone-0beb78c11c0f4537a27c53f8e46ddb86">Red Telephone (Emergency Phone)</a> 
                 by <a href="https://sketchfab.com/trickyegor">TrickyEgor</a>
                 licensed under CC BY 4.0
                 <p>
                    Music by <a href="/users/julius_h-3921568/?tab=audio&amp;utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=audio&amp;utm_content=5501">Julius_H</a> from <a href="https://pixabay.com/music/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=music&amp;utm_content=5501">Pixabay</a>”
                </p>
                 <p style="font-size: small;">The models on this page are also under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 license.</a></p>
            </div>
            </div>

            <div style="
            display: flex;
            flex-wrap: nowrap;
            flex-shrink: 1;
            flex-grow: 0;
            flex-direction:row;">
                <div style="
                    font-size: calc((1.2 - 1) * 1.2vh + 1rem);
                    margin-top: 2rem;
                    margin-right: 0px;
                    margin-bottom: 0rem;
                    margin-left: 0px;

                    width: 500px;
                    height: auto;">
                    <a id="usdz" rel="ar" href="experiences/0003/exp0003_m.usdz">
                        <picture>
                            <source type="image/webp" srcset="/thumbnails/0003.webp">
                            <source type="image/png" srcset="/thumbnails/0003.png">
                            <img src="/thumbnails/0003.png" width="100%" height=auto>
                          </picture> 
                    </a>
                </div>
            </div>

            <div id="ARcapable"> <!-- Hay que poner hidden cuando tiene Copyright-->
            <div style="
            display: flex;
            flex-wrap: nowrap;
            flex-shrink: 1;
            flex-grow: 0;
            flex-direction:row;
            margin-top: 2rem;
            margin-right: 0px;
            margin-bottom: 0rem;
            margin-left: 0px;">
            <div style="
                font-size: calc((1.2 - 1) * 1.2vh + 1rem);
                
                max-width: 500px;
                height: auto;">
                <b>Your message in your space!</b>
                <p>
                 - Customize a gift card and place this experience wherever you want.
                </p>
                <p>
                - Take a picture or shot a video and share with your loved ones.
                </p>
                <p>
                - Download your customized experience to share by message or email.
                </p>
            </div>
        </div>

        <div hidden style="font-family: ocr-a-std, serif;
        font-size: 30px;
        font-weight: 600;">
            Write your own card.
        </div>

        <style>

            label {
              max-width: 500px;  
              width: 100%;
              display:block;
            }
            
            input[type=text], select {
              max-width: 500px;  
              width: 100%;
              padding: 12px 20px;
              margin: 8px 0;
              display: inline-block;
              border: 1px solid #ccc;
              border-radius: 4px;
              box-sizing: border-box;
              display:block;
            }
            
            button {
              max-width: 500px;  
              width: 100%;
              background-color: #e4e4e4;
              color: rgb(0, 0, 0);
              padding: 14px 20px;
              margin: 8px 0;
              border: none;
              border-radius: 4px;
              cursor: pointer;
              display:block;
              font-weight: 400;
            }

            button:disabled {
              max-width: 500px;  
              width: 100%;
              background-color: #e4e4e4;
              color: rgb(255, 255, 255);
              padding: 14px 20px;
              margin: 8px 0;
              border: none;
              border-radius: 4px;
              cursor: pointer;
              display:block;
              
            }

            
            </style>

            <div>
            <br><br>
            <label for="title">Card Title</label>
            <input type="text" id="title" maxlength="15">
            <label for="line1">Content 1st Row</label>
            <input type="text" id="line1" maxlength="23">
            <label for="line2">Content 2nd Row</label>
            <input type="text" id="line2" maxlength="23">
            <label for="line3">Content 3rd Row</label>
            <input type="text" id="line3" maxlength="23">
            <label for="line4">Content 4th Row</label>
            <input type="text" id="line4" maxlength="23">
            <label for="footer">Card Footer</label>
            <input type="text" id="footer" maxlength="17">
            <button id="tarjeta" class="btn btn-primary">Customize Card</button>
            <button disabled id="blob" class="btn btn-primary">Remake 3D Model</button>
            <button disabled id="descarga" class="btn btn-primary">Download</button>

            <a id="usdzPlacer" rel="" href="">
                <img class="w3-image" id="imagen" src="./USDC/0/Material_baseColor.png" width="500" height="auto" style="-webkit-transform: scaleY(-1);
                transform: scaleY(-1);">
            </a>
            
            <p></p>
            <p></p>
            <canvas hidden id="canvas" width="512" height="512"></canvas>
        </div>

		</div>


        <script type="module">

			import './jszip/jszip.js';

        </script>

        <script>
            (function(d) {
            var config = {
                kitId: 'oep8ygu',
                scriptTimeout: 3000,
                async: true,
                loading: function() {
                    // JavaScript to execute when fonts start loading
                    console.log("loading");
                },
                active: function() {
                    // JavaScript to execute when fonts become active
                    console.log("active");
                    titlechange()
                },
                inactive: function() {
                    // JavaScript to execute when fonts become inactive
                    console.log("inactive");
                }
            },
            h=d.documentElement,
            t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},
            config.scriptTimeout),
            tk=d.createElement("script"),
            f=false,
            s=d.getElementsByTagName("script")[0],
            a;
            h.className+=" wf-loading";
            tk.src='https://use.typekit.net/'+config.kitId+'.js';
            tk.async=true;
            tk.onload=tk.onreadystatechange=function(){a=this.readyState;
            if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);
            try{Typekit.load(config)}catch(e){}};
            s.parentNode.insertBefore(tk,s)
            })(document);
        </script>

        <script>

            const b = document.createElement("a");
                if (b.relList.supports("ar")) {
                    document.getElementById("ARcapable").hidden = false;
                }


            document.getElementById("title").placeholder = "Call Me"
            document.getElementById("line1").placeholder  = "'A very little key"
            document.getElementById("line2").placeholder  = "will open a"
            document.getElementById("line3").placeholder  = "very heavy door'"
            document.getElementById("line4").placeholder  = "Hunted Down"
            document.getElementById("footer").placeholder  = "Charles Dickens"
            

            /*
            function createCanvas(width, height, set2dTransform = true) {
                const ratio = Math.ceil(window.devicePixelRatio);
                const canvas = document.createElement('canvas');
                canvas.width = width * ratio;
                canvas.height = height * ratio;
                canvas.style.width = `${width}px`;
                canvas.style.height = `${height}px`;
                if (set2dTransform) {
                    canvas.getContext('2d').setTransform(ratio, 0, 0, ratio, 0, 0);
                }
                return canvas;
            }

            var newCanvas = createCanvas(512,512)
            */

            async function addTextToImage(imagePath, text0, text1="", text2="", text3="", text4="", text5="", x=257, y=367, weight="600", fontsize0="48", fontsize1="30", fontsize2="40", fontfamily="ocr-a-std", align="center") {
                return new Promise(resolve =>{
                var circle_canvas = document.getElementById("canvas");
                //var circle_canvas = newCanvas
                var context = circle_canvas.getContext("2d");


                circle_canvas.style.width = "512px"
                circle_canvas.style.height = "512px"

                circle_canvas.width = 1024
                circle_canvas.height = 1024

                // Draw Image function
                var img = new Image();
                img.src = imagePath;
                img.onload = function () {
                    context.scale(2,2)
                    context.drawImage(img, 0, 0);
                    context.lineWidth = 1;
                    context.fillStyle = "#000000";
                    context.lineStyle = "#000000";
                    context.textAlign = align
                    context.scale(1,-1)
                    context.font = weight + " normal "+ fontsize0 +"px "+ fontfamily +",sans-serif";
                    context.fillText(text0, x, -y);
                    context.font = weight + " normal "+ fontsize1 +"px "+ fontfamily +",sans-serif";
                    context.fillText(text1, x, -y+64);
                    context.font = weight + " normal "+ fontsize1 +"px "+ fontfamily +",sans-serif";
                    context.fillText(text2, x, -y+100);
                    context.font = weight + " normal "+ fontsize1 +"px "+ fontfamily +",sans-serif";
                    context.fillText(text3, x, -y+136);
                    context.font = weight + " normal "+ fontsize1 +"px "+ fontfamily +",sans-serif";
                    context.fillText(text4, x, -y+172);
                    context.font = weight + " normal "+ fontsize2 +"px "+ fontfamily +",sans-serif";
                    context.fillText(text5, x, -y+230);
                    context.restore();
                    
                    //console.log(context.font);
                    resolve()
                };
            })}

            async function titlechange() {

                document.getElementById("blob").disabled = true;
                
                var text0 = document.getElementById("title").value;
                var text1 = document.getElementById("line1").value;
                var text2 = document.getElementById("line2").value;
                var text3 = document.getElementById("line3").value;
                var text4 = document.getElementById("line4").value;
                var text5 = document.getElementById("footer").value;

                imagePath = "./USDC/0/Material_baseColor.png"
                //console.log(text0);
                await addTextToImage(imagePath, text0, text1=text1, text2=text2, text3=text3, text4=text4, text5=text5)

                var canvas = document.getElementById("canvas");
                var image = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");  // here is the most important part because if you dont replace you will get a DOM 18 exception.

                //console.log(image);

                var element = document.getElementById("imagen");
                element.src = image

                
            }

            var element = document.getElementById("blob");
                element.onclick = function(event) {
                    generaUSDZ_C()
                console.log(event);
            }

            var element = document.getElementById("tarjeta");
                element.onclick = function(event) {
                    titlechange();
                    document.getElementById("blob").disabled = false;
                console.log(event);
            }


            function downloadX(data, filename, type) {
                var file = new Blob([data], {type: type});
                if (window.navigator.msSaveOrOpenBlob) // IE10+
                    window.navigator.msSaveOrOpenBlob(file, filename);
                else { // Others
                    var a = document.createElement("a"),
                            url = URL.createObjectURL(file);
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    setTimeout(function() {
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);  
                    }, 0); 
                }
            }
            
            function loadBlob(filePath) {
                return new Promise(resolve =>{
                    var result = null;
                    var xmlhttp = new XMLHttpRequest();
                    xmlhttp.open("GET", filePath, true);
                    xmlhttp.responseType = "arraybuffer";

                    xmlhttp.onload = function (oEvent) {
                        var arrayBuffer = xmlhttp.response;

                        resolve(arrayBuffer)
                    }
                    
                    xmlhttp.send(null);
                }
                )
            }

            async function generaUSDZ_C() {

                
                document.getElementById("blob").innerHTML = "WORKING ... plese wait";
                document.getElementById("blob").style.color = "red";
                document.getElementById("blob").disabled = true;
                document.getElementById("tarjeta").disabled = true;
                document.getElementById("descarga").disabled = true;

                var canvas = document.getElementById("canvas");
                //canvas = newCanvas
                var image = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");  // here is the most important part because if you dont replace you will get a DOM 18 exception.

                var zip2 = new JSZip();
                zip2.file("regalar.usdc",await loadBlob("./experiences/0003/exp0003_m.usdc"))

                zip2.file("0/music.mp3", await loadBlob("./experiences/0003/0/music.mp3"))
                zip2.file("1/dialing.mp3", await loadBlob("./experiences/0003/1/dialing.mp3"))
                zip2.file("2/dooropen.mp3", await loadBlob("./experiences/0003/2/dooropen.mp3"))

                zip2.file("3/baseColor-1.png", await loadBlob(image))
                zip2.file("4/Material_baseColor.png", await loadBlob("./experiences/0003/4/Material_baseColor.png"))

                zip2.file("3/entry_4__entry_4_Nor_baseColor_scale0.jpg", await loadBlob("./experiences/0003/3/entry_4__entry_4_Nor_baseColor_scale0.jpg"))
                zip2.file("3/entry_4__entry_4_Nor_metallicRoughness_metal_scale1.jpg", await loadBlob("./experiences/0003/3/entry_4__entry_4_Nor_metallicRoughness_metal_scale1.jpg"))
                zip2.file("3/entry_4__entry_4_Nor_metallicRoughness_rough.jpg", await loadBlob("./experiences/0003/3/entry_4__entry_4_Nor_metallicRoughness_rough.jpg"))
                zip2.file("3/lambert1_baseColor.jpg", await loadBlob("./experiences/0003/3/lambert1_baseColor.jpg"))
                zip2.file("3/lambert1_metallicRoughness_metal.jpg", await loadBlob("./experiences/0003/3/lambert1_metallicRoughness_metal.jpg"))
                zip2.file("3/lambert1_metallicRoughness_occl.jpg", await loadBlob("./experiences/0003/3/lambert1_metallicRoughness_occl.jpg"))
                zip2.file("3/lambert1_metallicRoughness_rough.jpg", await loadBlob("./experiences/0003/3/lambert1_metallicRoughness_rough.jpg"))
                zip2.file("3/lambert1_normal.jpg", await loadBlob("./experiences/0003/3/lambert1_normal.jpg"))


                zip2.generateAsync({type:"blob"})
                    .then(function (blob) {
                        const a = document.createElement("a");
                            if (a.relList.supports("ar")) {
                            // AR is available.
                                console.log("AR disponible");

                                var file = new Blob([blob], {type:"model/vnd.usdz+zip"});
                                var url = URL.createObjectURL(file);

                                var elementImagen = document.getElementById("imagen");
                                elementImagen.src = "./thumbnails/0003ready.png"

                                var elementAR = document.getElementById("usdzPlacer");
                                elementAR.rel = "ar"
                                elementAR.href = url

                                document.getElementById("blob").innerHTML = "Remake 3D Model";
                                document.getElementById("blob").style.color = "black";
                                document.getElementById("blob").disabled = false;
                                document.getElementById("tarjeta").disabled = false;

                                document.getElementById("descarga").onclick = function(event) {
                                    downloadX(blob, "regalAR.usdz", "model/vnd.usdz+zip");
                                }

                                document.getElementById("descarga").disabled = false;


                            } else {
                                console.log("AR NO disponible");

                                var elementImagen = document.getElementById("imagen");
                                elementImagen.src = "./thumbnails/0003ready.png"

                                document.getElementById("blob").innerHTML = "Remake 3D Model";
                                document.getElementById("blob").style.color = "black";
                                document.getElementById("blob").disabled = false
                                document.getElementById("tarjeta").disabled = false

                                document.getElementById("descarga").onclick = function(event) {
                                    downloadX(blob, "regalAR.usdz", "model/vnd.usdz+zip");
                                }

                                document.getElementById("descarga").disabled = false;
                                
                            }
                        //downloadX(blob, "toy2.usdz", "model/vnd.usdz+zip");
                        console.log("OK");
                    });
            }
            


            function loadFile(filePath) {
                var result = null;
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.open("GET", filePath, false);
                xmlhttp.send();
                if (xmlhttp.status==200) {
                    result = xmlhttp.responseText;
                }
            return result;
            }


        </script>


</body>
</html>